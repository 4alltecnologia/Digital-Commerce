<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href="https://fonts.googleapis.com/css?family=Dosis:300,500,700" rel=stylesheet>
    <title>4 Pay - Digital Commerce Web</title>

    <link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="images/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #f8f8f2;
  background-color: #272822;
}
.highlight .err {
  color: #151515;
  background-color: #ac4142;
}
.highlight .c, .highlight .cd, .highlight .cm, .highlight .c1, .highlight .cs {
  color: #505050;
}
.highlight .cp {
  color: #f4bf75;
}
.highlight .nt {
  color: #f4bf75;
}
.highlight .o, .highlight .ow {
  color: #d0d0d0;
}
.highlight .p, .highlight .pi {
  color: #d0d0d0;
}
.highlight .gi {
  color: #90a959;
}
.highlight .gd {
  color: #ac4142;
}
.highlight .gh {
  color: #6a9fb5;
  background-color: #151515;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #aa759f;
}
.highlight .kc {
  color: #d28445;
}
.highlight .kt {
  color: #d28445;
}
.highlight .kd {
  color: #d28445;
}
.highlight .s, .highlight .sb, .highlight .sc, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #90a959;
}
.highlight .sr {
  color: #75b5aa;
}
.highlight .si {
  color: #8f5536;
}
.highlight .se {
  color: #8f5536;
}
.highlight .nn {
  color: #f4bf75;
}
.highlight .nc {
  color: #f4bf75;
}
.highlight .no {
  color: #f4bf75;
}
.highlight .na {
  color: #6a9fb5;
}
.highlight .m, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mb, .highlight .mx {
  color: #90a959;
}
.highlight .ss {
  color: #90a959;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
  </head>

  <body class="web" data-languages="[]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.png" />
        <div class="lang-selector">
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Procurar">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='http://4all.com'>4all.com</a></li>
            <li><a href='https://4alltecnologia.github.io/Digital-Commerce/'>Home</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="digital-commerce-web-1-0">Digital Commerce Web - 1.0</h1>

<h1 id="1-introdu-o">1 Introdução</h1>

<p>Com o 4 Pay - Digital Commerce, você pode configurar seu website para aceitar pagamentos de cartões de crédito e débito de maneira fácil e rápida.</p>

<p>Para aceitar pagamentos de Cartão em seu site, você precisa executar os passos:</p>

<ol>
<li>Obter chaves de API no Portal do EC;</li>
<li>Incluir o a Janela de Checkout em seu site;</li>
<li>Capturar a transação no seu servidor.</li>
</ol>

<h2 id="1-1-endere-os-dos-servidores-de-homologa-o-e-de-produ-o">1.1 Endereços dos servidores de Homologação e de Produção</h2>

<p>Os seguintes endpoints devem ser usados para executar as chamadas:</p>

<table><thead>
<tr>
<th>Ambiente</th>
<th>URL</th>
</tr>
</thead><tbody>
<tr>
<td><strong>Homologação</strong></td>
<td>conta.homolog.4all.com</td>
</tr>
<tr>
<td><strong>Produção</strong></td>
<td>conta.api.4all.com</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody></table>

<h1 id="2-chaves-de-api">2 Chaves de API</h1>

<p>Para obter as Chaves de API, acesse o Portal do EC (https://portal.4all.com) e faça seu login. No menu lateral, clique na opção “Chaves de API” no sub-menu “Digital Commerce”.</p>

<p>Nesta página você pode obter pares de chaves no ambiente de Homologação ou no Ambiente de Produção.</p>

<p>Clique no botão “Gerar Chaves” para obter um par de chaves, a Pública (<strong>PublicApiKey</strong>) e a Privada (<strong>MerchantKey</strong>).</p>

<h1 id="3-incluindo-a-janela-de-checkout-em-seu-site">3 Incluindo a Janela de Checkout em seu Site</h1>

<p>A Janela de Checkout é apresentada quando o cliente confirma a compra (no <em>submit</em> do formulário de fechar pedido, por exemplo) ou seleciona a forma de pagamento &ldquo;Cartão de Crédito ou Débito via 4all&rdquo; (quando o seu site permite mais de uma forma de pagamento).</p>

<p>O <em>dialog</em> permite que o usuário informe os dados do cartão ou se autentique com sua Conta 4all para buscar seus dados de pagamento já cadastrados.</p>

<p>Você pode inserir o Dialog no seu site de duas maneiras: via <strong>Embedded Form</strong>, ou via a nossa <strong>Biblioteca Javascript</strong>.</p>

<h2 id="3-1-embedded-form">3.1 Embedded Form</h2>
<pre class="highlight html"><code><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"pedido_concluido.php"</span> <span class="na">method=</span><span class="s">"POST"</span><span class="nt">&gt;</span>

  <span class="c">&lt;!-- … demais inputs do formulário … --&gt;</span>

  <span class="nt">&lt;script
    </span><span class="na">src=</span><span class="s">"https://lib.4all.com/lib/checkout-express.js"</span>
    <span class="na">data-public-api-key=</span><span class="s">"pk_test_6pRNASCoBOKtIshFeQd4XMUh"</span>
    <span class="na">data-amount=</span><span class="s">"5999"</span>
    <span class="nt">&gt;</span>
  <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre>

<p><strong>Como funciona:</strong> Nesta modalidade de checkout, você adiciona à sua página um formulário que efetua, de forma segura, todo o processo de captura e validação dos dados de pagamento do cliente, assim, as informações sensíveis do seu cliente nunca entram em contato com ambientes não-seguros. Após a captura e validação dos dados, é adicionado ao formulário um token de pagamento (válido para apenas <strong>uma</strong> transação) que deverá ser utilizado para efetuar a confirmação na API de pagamentos 4all.</p>

<p>No evento de <em>submit</em> do seu formulário, a Janela de Checkout será apresentada para o cliente inserir os dados de pagamento.</p>

<p>Substitua o valor de cada atributo de acordo com o pagamento a ser efetuado. Os atributos aceitos são:</p>

<table><thead>
<tr>
<th>Atributo</th>
<th>Descrição</th>
<th>Formato</th>
<th>Obrigatório</th>
</tr>
</thead><tbody>
<tr>
<td><strong>data-public-api-key</strong></td>
<td>Chave de API pública do Checkout all.</td>
<td>String</td>
<td>Sim</td>
</tr>
<tr>
<td><strong>data-amount</strong></td>
<td>Valor da transação em centavos. Ex: &ldquo;1425&rdquo; para R$ 14,25.</td>
<td>String</td>
<td>Sim</td>
</tr>
</tbody></table>

<p>Se o cliente efetuar o pagamento, um novo campo <code class="prettyprint">&lt;input type=&quot;hidden&quot; id=&quot;payment_token&quot;&gt;</code> contendo o <strong>payment_token</strong> é adicionado ao seu formulário, e o <em>submit</em> é efetuado.</p>

<h2 id="3-2-biblioteca-javascript">3.2 Biblioteca Javascript</h2>
<pre class="highlight html"><code><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://lib.4all.com/lib/checkout-lib.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
</code></pre>

<p>Para fazer a integração via javascript, você deve primeiramente importar o arquivo da biblioteca na sua página, adicionando ao seu HTML a linha abaixo ou ao lado.</p>
<pre class="highlight javascript"><code>    <span class="kd">function</span> <span class="nx">onSuccess</span><span class="p">(</span><span class="nx">paymentToken</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">//esta função será chamada ao completar o checkout</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">onCancel</span><span class="p">()</span> <span class="p">{</span>
      <span class="c1">// esta funcão será chamada caso o cliente cancele o checkout</span>
    <span class="p">}</span>

    <span class="nx">Var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">amount</span><span class="p">:</span> <span class="mi">2500</span><span class="p">,</span>
      <span class="na">publicApiKey</span><span class="p">:</span> <span class="s2">"pk_test_6pRNASCoBOKtIshFeQd4XMUh"</span><span class="p">,</span>
      <span class="na">successCallback</span><span class="p">:</span> <span class="nx">onSuccess</span><span class="p">,</span>
      <span class="na">cancelCallback</span><span class="p">:</span> <span class="nx">onCancel</span><span class="p">,</span>

        <span class="c1">//se você já tem dados do usuário, você pode informar à biblioteca para acelerar o processo de cadastro</span>
        <span class="na">input</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">name</span><span class="p">:</span> <span class="s1">'Fulano de tal'</span><span class="p">,</span>
            <span class="na">phone</span><span class="p">:</span> <span class="s1">'51999998888'</span><span class="p">,</span> <span class="c1">//ddd e telefone</span>
            <span class="na">email</span><span class="p">:</span> <span class="s1">'fulano@gmail.com'</span><span class="p">,</span>
            <span class="na">document</span><span class="p">:</span> <span class="s1">'00000000000'</span><span class="p">,</span> <span class="c1">//cpf do usuário</span>
            <span class="na">birthdate</span><span class="p">:</span> <span class="s1">'10/02/1992'</span> <span class="c1">//data de nascimento no formato DD/MM/AAAA</span>
        <span class="p">},</span>

        <span class="c1">//adicione este treixo se você deseja que a autenticação de usuário seja somente via código SMS</span>
        <span class="na">rules</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">smsOnly</span><span class="p">:</span> <span class="kc">true</span>
        <span class="p">}</span>
    <span class="p">};</span>

<span class="nx">Checkout4all</span><span class="p">.</span><span class="nx">startCheckout</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
</code></pre>

<p>Após isso, a biblioteca está disponível em seu escopo global como &lsquo;Checkout4all&rsquo;. Para iniciar o processo de login/pagamento, basta chamar a função <strong>startCheckout</strong> da biblioteca, como demonstrado abaixo ou ao lado (código javascript).</p>

<p>Esta função recebe um objeto com os parâmetros:</p>

<table><thead>
<tr>
<th>Atributo</th>
<th>Descrição</th>
<th>Formato</th>
<th>Obrigatório</th>
</tr>
</thead><tbody>
<tr>
<td><strong>amount</strong></td>
<td>Valor da transação em centavos. Ex: &ldquo;1425&rdquo; para R$ 14,25.</td>
<td>String</td>
<td>Sim</td>
</tr>
<tr>
<td><strong>publicApiKey</strong></td>
<td>Chave de API pública do Checkout 4all.</td>
<td>String</td>
<td>Sim</td>
</tr>
<tr>
<td><strong>successCallback</strong></td>
<td>Função que será chamada quando o checkout estiver finalizado com sucesso. Recebe o paymentToken como parâmetro.</td>
<td>Função</td>
<td>Sim</td>
</tr>
<tr>
<td><strong>cancelCallback</strong></td>
<td>Função que será chamada caso o usuário cancele o processo de pagamento sem concluí-lo.</td>
<td>Função</td>
<td>Não</td>
</tr>
<tr>
<td><strong>input</strong></td>
<td>Caso já tenha coletado dados do usuário, você pode acelerar o processo de login/cadastro fornecendo os dados do usuário neste objeto.</td>
<td>Objeto (olhar abaixo)</td>
<td>Não</td>
</tr>
<tr>
<td><strong>rules</strong></td>
<td>Objeto com opções para o funcionamento da biblioteca.</td>
<td>Objeto (olhar abaixo)</td>
<td>Não</td>
</tr>
</tbody></table>

<p>Objeto <em>input</em>:</p>

<table><thead>
<tr>
<th>Atributo</th>
<th>Descrição</th>
<th>Formato</th>
<th>Obrigatório</th>
</tr>
</thead><tbody>
<tr>
<td><strong>name</strong></td>
<td>Nome completo do usuário.</td>
<td>String</td>
<td>Não</td>
</tr>
<tr>
<td><strong>phone</strong></td>
<td>Telefone do usuário, com DDD.</td>
<td>String</td>
<td>Não</td>
</tr>
<tr>
<td><strong>email</strong></td>
<td>Email do usuário, com DDD.</td>
<td>String</td>
<td>Não</td>
</tr>
<tr>
<td><strong>document</strong></td>
<td>CPF do usuário.</td>
<td>String</td>
<td>Não</td>
</tr>
<tr>
<td><strong>birthdate</strong></td>
<td>Data de nascimento do usuário, formato DD/MM/AAAA.</td>
<td>String</td>
<td>Não</td>
</tr>
</tbody></table>

<p>Objeto <em>rules</em>:</p>

<table><thead>
<tr>
<th>Atributo</th>
<th>Descrição</th>
<th>Formato</th>
<th>Obrigatório</th>
</tr>
</thead><tbody>
<tr>
<td><strong>smsOnly</strong></td>
<td>Caso configurado como <em>true</em>, não será solicitada senha ao usuário, e a autenticação é feita somente por código SMS enviado ao telefone do usuário.</td>
<td>Boolean</td>
<td>Não</td>
</tr>
</tbody></table>

<h1 id="4-capturando-a-transa-o">4 Capturando a transação</h1>

<p>Com o <strong>payment_token</strong> em mãos, você pode capturar a transação (efetuar a cobrança) através de uma chamada à API Conta 4all.</p>

<aside class="notice">
Nota:  por motivos de segurança, você deve informar o valor total da transação novamente nesta chamada.
</aside>

<aside class="notice">
Em caso de erro de comunicação ao executar esta chamada, você deve consultar o estado da transação utilizando a chamada descrita na seção 4.1 para verificar se a transação foi capturada com sucesso ou não.
</aside>
<pre class="highlight shell"><code>curl -H <span class="s2">"Content-Type: application/json"</span>
-X POST
-d <span class="s1">'{"merchantKey":"MDEyMzQ1Njc4OTAxMjMN...","paymentToken":"MDEyM...", "amount": 5000}'</span>
https://conta.api.4all.com/merchant/issueAuthorizedTransaction
</code></pre>

<p><strong>Caminho</strong>: <code class="prettyprint">&lt;endpoint&gt;/merchant/issueAuthorizedTransaction</code></p>

<p><strong>Descrição</strong>: Captura uma transação pelo <strong>paymentToken</strong></p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"merchantKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MDEyMzQ1Njc4OTAxMjMN..."</span><span class="p">,</span><span class="w">
    </span><span class="nt">"paymentToken"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MDEyM..."</span><span class="p">,</span><span class="w">
    </span><span class="nt">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">5000</span><span class="p">,</span><span class="w">
    </span><span class="nt">"merchantMetaId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1259"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"returnImmediatly"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p><strong>Requisição</strong>:</p>

<table><thead>
<tr>
<th>Atributo</th>
<th>Descrição</th>
<th>Formato</th>
<th>Tamanho</th>
<th>Obrigatório</th>
</tr>
</thead><tbody>
<tr>
<td><strong>merchantKey</strong></td>
<td>Chave de acesso do estabelecimento à API</td>
<td>String</td>
<td>44</td>
<td>Sim</td>
</tr>
<tr>
<td><strong>paymentToken</strong></td>
<td>Token da autorização de pagamento, obtido do Checkout.</td>
<td>String</td>
<td>44</td>
<td>Sim</td>
</tr>
<tr>
<td><strong>amount</strong></td>
<td>Valor da transação, em centavos.</td>
<td>Number</td>
<td>*</td>
<td>Sim</td>
</tr>
<tr>
<td><strong>merchantMetaId</strong></td>
<td>Identificador único, atribuído pelo estabelecimento comercial, para poder pesquisar esta transação em caso de não recebimento da resposta desta chamada (contendo o transactionId). Deve ser um valor numérico inteiro (representado como string).</td>
<td>String</td>
<td>20</td>
<td>Não</td>
</tr>
<tr>
<td><strong>returnImmediatly</strong></td>
<td>Quando presente e com valor <strong>true</strong> , a chamada retorna imediatamente. Neste caso, a transação estará com um status pendente (estados 0, 1 ou 2 vide <strong>seção 6 desta documentação</strong>).</td>
<td>Boolean</td>
<td></td>
<td>Não</td>
</tr>
</tbody></table>

<p><strong>Observações</strong>:</p>

<ul>
<li>O parâmetro &ldquo;transactionAuthorizationToken&rdquo; deve ser obtido através da Biblioteca Javascript ou Embedded Form.</li>
<li>O chamador deve estar preparado para lidar com tempos de resposta longos, de até 30 segundos (a menos que o parâmetro <code class="prettyprint">returnImmediatly</code> seja passado como <code class="prettyprint">true</code>, neste caso, a chamada retorna imediatamente).</li>
<li>Caso o parâmetro <code class="prettyprint">returnImmediatly</code> seja passado como <code class="prettyprint">true</code>, a chamada retorna imediatamente, porém o resultado da transação deve ser consultada posteriormente utilizando a chamada descrita na seção 5.1.</li>
</ul>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"transactionId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2181486"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
    </span><span class="nt">"datetime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-08-31T20:12:31Z"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p><strong>Resposta</strong>:</p>

<table><thead>
<tr>
<th>Atributo</th>
<th>Descrição</th>
<th>Formato</th>
<th>Tamanho</th>
<th>Presente</th>
</tr>
</thead><tbody>
<tr>
<td><strong>transactionId</strong></td>
<td>Identificador da transação.</td>
<td>String</td>
<td>20</td>
<td>Sempre</td>
</tr>
<tr>
<td><strong>status</strong></td>
<td>Estado da transação (ver <strong>seção 6 desta documentação</strong>).</td>
<td>Number</td>
<td>*</td>
<td>Sempre</td>
</tr>
<tr>
<td><strong>datetime</strong></td>
<td>Data e hora UTC em que a transação foi processada pelo servidor 4all. Formato YYYYMMDDThh:mm:ssZ (Formato ISO 8601 https://en.wikipedia.org/wiki/ISO_8601).</td>
<td>String</td>
<td>20</td>
<td>Sempre</td>
</tr>
</tbody></table>

<p><strong>Tratamento de Erro</strong>
Em caso de erro na chamada, o status HTTP retornado será diferente de <strong>200</strong>,  e o corpo da mensagem conterá um objeto no formato JSON contendo um objeto <strong>error</strong> contendo um código(<strong>code</strong>) e uma mensagem(<strong>message</strong>).</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"error"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">2318</span><span class="p">,</span><span class="w">
        </span><span class="nt">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Payment Token inválido."</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h2 id="4-1-consultando-uma-transa-o">4.1 Consultando uma transação</h2>

<p>Em caso de erro na chamada de captura de transação, você pode consultar o estado da transação através do Meta ID passado na chamada de Captura.</p>
<pre class="highlight shell"><code>curl -H <span class="s2">"Content-Type: application/json"</span>
-X POST
-d <span class="s1">'{"merchantKey":"MDEyMzQ1Njc4OTAxMjMN...","transactionId":"73423624"}'</span>
https://conta.api.4all.com/merchant/getTransactionDetails
</code></pre>

<p><strong>Caminho</strong>: <code class="prettyprint">&lt;endpoint&gt;/merchant/getTransactionDetails</code></p>

<p><strong>Descrição</strong>:  Retorna os detalhes de uma transação.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"merchantKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MDEyMzQ1Njc4OTAxMjMN..."</span><span class="p">,</span><span class="w">
    </span><span class="nt">"merchantMetaId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1259"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p><strong>Requisição</strong>:</p>

<table><thead>
<tr>
<th>Atributo</th>
<th>Descrição</th>
<th>Formato</th>
<th>Tamanho</th>
<th>Obrigatório</th>
</tr>
</thead><tbody>
<tr>
<td><strong>merchantKey</strong></td>
<td>Chave de acesso do merchant à API</td>
<td>String</td>
<td>44</td>
<td>Sim</td>
</tr>
<tr>
<td><strong>transactionId</strong></td>
<td>Identificador da transação</td>
<td>String</td>
<td>20</td>
<td>Depende</td>
</tr>
<tr>
<td><strong>merchantMetaId</strong></td>
<td>Identificador único, atribuído pelo estabelecimento comercial, que será usado como chave na pesquisa.</td>
<td>String</td>
<td>20</td>
<td>Depende</td>
</tr>
</tbody></table>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"transactionId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"854383518"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"amount"</span><span class="p">:</span><span class="w"> </span><span class="mi">5000</span><span class="p">,</span><span class="w">
    </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
    </span><span class="nt">"createdAt"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-01-31T20:12:31Z"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"paidAt"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2016-01-31T20:33:12Z"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"authorizationInfo"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"acquirerId"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="nt">"acquirerUsn"</span><span class="p">:</span><span class="w"> </span><span class="s2">"18318318"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"acquirerTimestamp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"20161231125959"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"brandId"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p><strong>Resposta:</strong></p>

<table><thead>
<tr>
<th>Atributo</th>
<th>Descrição</th>
<th>Formato</th>
<th>Tamanho</th>
<th>Presente</th>
</tr>
</thead><tbody>
<tr>
<td><strong>transactionId</strong></td>
<td>Identificador da transação</td>
<td>String</td>
<td>20</td>
<td>Sempre</td>
</tr>
<tr>
<td><strong>subscriptionId</strong></td>
<td>Quando presente, informa o identificador da assinatura que gerou esta transação.</td>
<td>String</td>
<td>20</td>
<td>Depende</td>
</tr>
<tr>
<td><strong>amount</strong></td>
<td>Valor da transação, em centavos.</td>
<td>Number</td>
<td></td>
<td>Sempre</td>
</tr>
<tr>
<td><strong>status</strong></td>
<td>Estado da transação (ver <strong>seção 6 desta documentação</strong>).</td>
<td>Number</td>
<td></td>
<td>Sempre</td>
</tr>
<tr>
<td><strong>createdAt</strong></td>
<td>Data e hora UTC em que a transação foi criada no servidor 4all (formato YYYYMMDDThh:mm:ssZ).</td>
<td>String</td>
<td>20</td>
<td>Sempre</td>
</tr>
<tr>
<td><strong>paidAt</strong></td>
<td>Data e hora UTC em que a transação foi paga por uma conta 4all (formato YYYYMMDDThh:mm:ssZ). Presente somente se a transação já foi paga.</td>
<td>String</td>
<td>20</td>
<td>Depende</td>
</tr>
<tr>
<td><strong>authorizationInfo</strong></td>
<td>Objeto contendo detalhes de autorização da transação. Presente somente se a transação já foi paga.</td>
<td>Object</td>
<td>*</td>
<td>Depende</td>
</tr>
</tbody></table>

<p><strong><em>authorizationInfo:</em></strong></p>

<table><thead>
<tr>
<th>Atributo</th>
<th>Descrição</th>
<th>Formato</th>
<th>Tamanho</th>
<th>Presente</th>
</tr>
</thead><tbody>
<tr>
<td><strong>acquirerId</strong></td>
<td>Identificador do adquirente.</td>
<td>Number</td>
<td></td>
<td>Sempre</td>
</tr>
<tr>
<td><strong>acquirerUsn</strong></td>
<td>Identificador/NSU do adquirente para a transação.</td>
<td>String</td>
<td>50</td>
<td>Sempre</td>
</tr>
<tr>
<td><strong>acquirerTimestamp</strong></td>
<td>Timestamp de pagamento conforme reportado pelo adquirente. O formato e timezone deste campo segue o formato usado pelo adquirente. Presente somente se o adquirente informar.</td>
<td>String</td>
<td>50</td>
<td>Depende</td>
</tr>
<tr>
<td><strong>brandId</strong></td>
<td>Identificador da bandeira do cartão que foi usado no pagamento.</td>
<td>Number</td>
<td></td>
<td>sempre</td>
</tr>
</tbody></table>

<p><strong>Observações</strong></p>

<p>Apenas um dos dois parâmetros, <strong><em>transactionId</em></strong> ou <strong><em>merchantMetaId</em></strong>, pode ser usado; se ambos
estiverem presentes, esta chamada falha com um erro específico.</p>

<ul>
<li><p>Adquirentes:</p>

<ol>
<li>Stone</li>
<li>Pagar.me</li>
</ol></li>
<li><p>Bandeiras:</p>

<ol>
<li>Visa</li>
<li>Mastercard</li>
</ol></li>
</ul>

<p><strong>Tratamento de Erro</strong>
Em caso de erro na chamada, o status HTTP retornado será diferente de <strong>200</strong>,  e o corpo da mensagem conterá um objeto no formato JSON contendo um objeto <strong>error</strong> contendo um código(<strong>code</strong>) e uma mensagem(<strong>message</strong>).</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"error"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"code"</span><span class="p">:</span><span class="w"> </span><span class="mi">2318</span><span class="p">,</span><span class="w">
        </span><span class="nt">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Payment Token inválido."</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h2 id="4-2-cancelamento-uma-transa-o">4.2. Cancelamento uma transação</h2>

<p>Também é possível efetuar o cancelamento de uma transação previamente aprovada</p>
<pre class="highlight shell"><code>curl -H <span class="s2">"Content-Type: application/json"</span>
-X POST
-d <span class="s1">'{"merchantKey":"MDEyMzQ1Njc4OTAxMjMN...","transactionId":"73423624"}'</span>
https://conta.api.4all.com/merchant/refundTransaction
</code></pre>

<p><strong>Caminho</strong>: <code class="prettyprint">&lt;endpoint&gt;/merchant/refundTransaction</code></p>

<p><strong>Descrição</strong>: Funcionalidade para estornar/cancelar uma transação.</p>

<p>Em alguns casos, o cancelamento da transação pode não ser mais possível pois o prazo limite para realizar a operação já se esgotou.</p>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"merchantKey"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MDEyMzQ1Njc4OTAxMjMNT..."</span><span class="p">,</span><span class="w">
  </span><span class="nt">"transactionId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2181486"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p><strong>REQUISIÇÃO:</strong></p>

<table><thead>
<tr>
<th>Campo</th>
<th>Descrição</th>
<th>Formato</th>
<th>Tam.</th>
<th>Obrigatório</th>
</tr>
</thead><tbody>
<tr>
<td><strong>merchantKey</strong></td>
<td>Chave de acesso do merchant à API.</td>
<td>String</td>
<td>44</td>
<td>sim</td>
</tr>
<tr>
<td><strong>transactionId</strong></td>
<td>Identificador da transação.</td>
<td>String</td>
<td>20</td>
<td>sim</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>

<p><strong>RESPOSTA:</strong> HTTP 204</p>

<h1 id="6-estados-de-uma-transa-o">6. Estados de uma Transação</h1>

<table><thead>
<tr>
<th>Estado</th>
<th>Descrição</th>
</tr>
</thead><tbody>
<tr>
<td>0</td>
<td>Transação aguardando pagamento.</td>
</tr>
<tr>
<td>1</td>
<td>Transação em processamento.</td>
</tr>
<tr>
<td>2</td>
<td>Transação não aprovada.</td>
</tr>
<tr>
<td>3</td>
<td>Transação aprovada.</td>
</tr>
<tr>
<td>4</td>
<td>Transação em cancelamento.</td>
</tr>
<tr>
<td>5</td>
<td>Transação cancelada.</td>
</tr>
<tr>
<td>6</td>
<td>Transação aprovada (cancelamento falhou).</td>
</tr>
<tr>
<td>7</td>
<td>Transação contestada.</td>
</tr>
<tr>
<td>8</td>
<td>Transação reapresentada.</td>
</tr>
<tr>
<td>9</td>
<td>Transação aguardando confirmação.</td>
</tr>
</tbody></table>

<h1 id="homologa-o">Homologação</h1>

<aside class="notice">
Para realizar transações no ambiente de Homologação, utilize um par de chaves de Homologação, obtidas no Portal do EC.
</aside>

<p>No Ambiente de Homologação, as transações efetuadas não geram cobranças, de modo que você pode testar a integração de seu Site com o Digital Commerce 4all.</p>

<p>No Portal do EC, você pode gerar chaves para o ambiente de Homologação. Quando você usa uma chave de Homologação, aparecerá uma mensagem na Janela de Checkout indicando que você está no ambiente de Homologação e as transações efetuadas não resultarão em cobranças.</p>

<h2 id="conta-4all-no-ambiente-de-homologa-o">Conta 4all no Ambiente de Homologação</h2>

<p>Nas contas criadas no ambiente de Homologação, o envio de SMS não é disparado, e os desafios de SMS podem ser respondidos com &ldquo;444444&rdquo;.</p>

<h2 id="cart-es-de-teste">Cartões de Teste</h2>

<p>No ambiente de Homologação, você pode utilizar cartões de gerados e qualquer CVV de 3 dígitos para testar compras em seu Site.</p>

<p><strong>Cartões de final PAR sempre resultam em compras efetivadas com sucesso.</strong>
<strong>Cartões de final ÍMPAR sempre resultam em transações negadas.</strong></p>

<p>Você pode utilizar o seguinte website para gerar cartões de teste: http://credit-card-generator.2-ee.com/</p>

<aside class="notice">
Nota:  a 4all não permite que o mesmo cartão seja utilizado em duas contas diferentes. Este comportamento também é aplicado no ambiente de homologação.
</aside>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
          </div>
      </div>
    </div>
  </body>
</html>
